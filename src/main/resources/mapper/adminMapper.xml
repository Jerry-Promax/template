<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.UserMapper">

    <insert id="insertUser" parameterType="com.example.demo.entity.User">
        insert into all_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="username != null">
                username,
            </if>
            <if test="password != null">
                password,
            </if>
            <if test="name != null">
                name,
            </if>
            <if test="sex != null">
                sex,
            </if>
            <if test="tel != null">
                tel,
            </if>
            <if test="address != null">
                address,
            </if>
            <if test="email != null">
                email,
            </if>
            <if test="avatar != null">
                avatar,
            </if>
            <if test="role != null">
                role,
            </if>
            <!-- 字段名列表中始终包含 create_time -->
            create_time
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="username != null">
                #{username},
            </if>
            <if test="password != null">
                #{password},
            </if>
            <if test="name != null">
                #{name},
            </if>
            <if test="sex != null">
                #{sex},
            </if>
            <if test="tel != null">
                #{tel},
            </if>
            <if test="address != null">
                #{address},
            </if>
            <if test="email != null">
                #{email},
            </if>
            <if test="avatar != null">
                #{avatar},
            </if>
            <if test="role != null">
                #{role},
            </if>
            <!-- 根据 createTime 是否为空决定使用传入值还是数据库函数 -->
            <choose>
                <when test="createTime != null">
                    #{createTime}
                </when>
                <otherwise>
                    NOW()
                </otherwise>
            </choose>
        </trim>
    </insert>
    <update id="updatePerson">
        update all_user
        <set>
            <if test="password != null and password != ''">
                password = #{password},
            </if>
            <if test="name != null and name != ''">
                name = #{name},
            </if>
            <if test="sex != null and sex !=''" >
                sex = #{sex},
            </if>
            <if test="tel != null and tel != ''">
                tel = #{tel},
            </if>
            <if test="email != null and email != ''">
                email = #{email},
            </if>
            <if test="address != null and address != ''">
                address = #{address},
            </if>
            <if test="avatar != null and avatar != ''">
                avatar = #{avatar},
            </if>
            <if test="role != null and role !=''">
                role = #{role}
            </if>
        </set>
        where id = #{id}
    </update>
<!--    <select id="selectByUsername" resultType="com.example.demo.entity.User">-->
<!--        SELECT * FROM all_user-->
<!--        <where>-->
<!--            <if test="username != null and username != ''">-->
<!--                username LIKE CONCAT('%', #{username}, '%')-->
<!--            </if>-->
<!--        </where>-->
<!--    </select>-->
    <select id="selectAllUser" resultType="com.example.demo.entity.User">
        SELECT * FROM all_user
        <where>
            <if test="username != null and username != ''">
                username LIKE CONCAT('%', #{username}, '%')
            </if>
            <if test="status != null and status != 0">
                AND status = #{status}
            </if>
        </where>
        LIMIT #{pageNum}, #{pageSize}
    </select>
    <select id="selectCountByPage" resultType="Integer">
        SELECT count(*) FROM all_user
        <where>
            <if test="username != null and username != ''">
                username LIKE CONCAT('%', #{username}, '%')
            </if>
            <if test="status != null and status != 0">
                AND status = #{status}
            </if>
        </where>
    </select>
</mapper>